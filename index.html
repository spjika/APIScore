<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Scores</title>
  <meta name="description" content="OUSD API Scores Web Map">
  <meta name="author" content="InfoAlameda">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">

<!-- Optional theme -->
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="styles.css">
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
<!--Actual Mark-up-->
<header class="title" style="margin-bottom:20px">
  <div class="container-fluid">
	<div class="row-fluid vcenter">
		<div class='col-md-2 text-center'>
			<a href="https://www.gopublicschools.org/"><img class="text-center" src="images/go_leadercenter.jpg" style="width:168px;height:84px;padding-top:5px" alt="Go Public Schools Logo"></a>
		</div>
		<div class="col-md-8 vcenter text-center">
			<h2>Oakland Public Schools API Scores</h2>
			<h4 style="color:#4ab100">2012 to 2013</h4>
		</div>
		<div class="col-md-2 vcenter text-right">
			<a class="about" href="#abt">ABOUT</a>
		</div>
	</div>
	  <div class="row-fluid">
		<div class="col-md-6">
		  <div class="pull-right hidden-sm">    
			<!--<h1><a href="#glyphicon"><i class="glyphicon glyphicon-user"></i> <i class="glyphicon glyphicon-chevron-down"></i></a></h1>-->
		  </div>
		</div>
	  </div>
  </div>
</header>
<div class="col-md-12"   >	
	<nav class="navbar navbar-default" role="navigation">
		<div class="container-fluid">
			<div class="navbar-header navbar-inner col-md-12" id="headerRow">
			   
			  <button type="button" class="navbar-toggle" id="dropDownMenu" data-toggle="collapse" data-target=".navbar-collapse">
				<span class="sr-only"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			 
			  </button>
			 <span id="lblSelect">SELECT A SUBGROUP:</span>
			 <div class="collapse navbar-collapse" id="dropMenu">
				
				<ul id="menu" class="nav navbar-nav navbar-inner">
				  <li class="active"><a data-match= 'ALL' href="#contact">ALL STUDENTS</a></li>
				  <li><a data-match= 'AS' href="#contact">ASIAN</a></li>
				  <li><a data-match= 'AA' href="#contact">AFRICAN-AMERICAN or BLACK</a></li>
				  <li><a data-match= 'HI' href="#contact">LATINO</a></li>
				  <li><a data-match= 'WH' href="#contact">WHITE</a></li>
				  <li><a data-match= 'EL' href="#contact">ENGLISH LEARNER</a></li>
				  <li><a data-match= 'SD' href="#contact">LOW INCOME</a></li>
				  <li><a data-match= 'DI' href="#contact">DISABILITY</a></li>

				</ul>
			</div>
		</div> 
	</nav>
</div>
	<div class="container-fluid" style="margin-top:20px">
		
		<div class="row-fluid">
			<div class="col-md-8">
				<div class="row">
					<div id="map" class="shadow">
					</div>
				</div>
				<div class="row">
					<ul class="nav" id="legendList">
							<li>Above 900</li>
							<li>800 to 899</li>
							<li>700 to 799</li>
							<li>600 to 699</li>
							<li>500 to 599</li>
							<li>Below 5000</li>
					
					 </ul>
				</div>
			</div>
		
			<div class="col-md-4" id="infoArea">
				
				
				<div class="row">
					<div class="col-md-12">
					<!--<h4 id='theDistrict'></h4>-->
						<div id="selectedSchool">
						<h5 id="lblSelected">All Students</h5>	
						<table id="theScores" class="tablesorter table-responsiv table-condensed">
							<thead>
							<tr id="headerRow">
								<th>School<span  class="glyphicon glyphicon-eject" style="color:#66CD00;float:right" ></span></th>
								<th id="selScore"></span><span style="text-transform:uppercase"> API </span> Score <span  style="color:#66CD00" class="glyphicon glyphicon-eject" ></th>
								<th class="thirdColumn">Difference from School's Average<span class="glyphicon glyphicon-eject" style="color:#66CD00;float:right" ></span></span></th>
							</tr>
							</thead>
							<tbody id="theSchools">
							
							</tbody>
						</table>
						</div>
					</div>
				</div>
			
				<div class="row">
					<div class="col-md-10">
						<div id="summaryBox" style="display:none">
						
							<div id="chartArea"></div>
						</div>
					</div>
				</div>
			</div>
		<div class="row-fluid">
			<div class="col-md-12" id="aboutsection">
			<!--<a name="about"></a>-->
				<h2><a name="abt"></a>What are API Scores?</h2>
					<ul class="faq">
					<li>The Academic Performance Index (API) measures the academic performance and improvement of schools.  This is based on results from Standardized Testing & Reporting (STAR) and the California High School Exit Exam (CAHSEE).</li>
					<li>The state has set a score of 800 out of a possible 1,000 as the target for all schools to meet.</li>
					<li>However, because the tests are changing to the new Common Core State Standards, there will be no more API scores until the 2015-2016 school year. This is to allow the whole system to adapt to this new testing approach.</li>
					<li>Up until 2012 Oakland was the most improved urban schol district for the previous eight years!</li>
					<li>Scores in 2012/2013 went down in Oakland which was consistent with the trends statewide- the first time scores fell widely in more than a decade.</li>
					<li>Each sub group of students is scored separately. We believe it is important to understand the way that different groups perform compared to other groups, which is why we have made it easy for you to map the scores for different ethnic and other sub groups of or school district.</li>
					<li>This site includes both public schools and public charter schools.</li>
					<li>"Asian" subgroup does not include Filipino(241 students) or Native Hawaiian or Pacific Islanders (312 students).</li>
					<li>Please refer to <a href='http://www.cde.ca.gov/ta/ac/ap/glossary13f.asp#gf15'>California Department of Education </a> website for descriptions of subgroups and API testing</li>
					</ul>
			</div>
		</div>

<div class="container">
      <div class="row">
        <div class="col-xs-12 col-md-12">
			<h2 class="text-center">Built by</h2>
				<a href="http://urbanstrategies.org"><img src="images/usclogo.png" width="170" class="img-responsive center-block"></a>
        </div><!-- /.col-xs-12 -->
      </div><!-- /.row -->
</div> <!-- container -->
      

      <!-- FOOTER -->
      <footer>
        <p class="pull-right"><a href="#">Back to top</a></p>
        <p>Openly licensed- Fork this site &middot; <a href="https://github.com/urbanstrategies/APIScore">Code on GitHub</a> &middot;</p>
      </footer>

    
  <!--script stuff-->
	  <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
	  <script src="jquery.tablesorter.min.js"></script>
	  <link rel="stylesheet" href="style.css" />
	  <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
	  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
	  <script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>
	  <script src="OUSD_APIScores_1213.json"></script>
	  <script src="Data.js"></script>
	  <script type="text/javascript" src="highcharts.js"></script>
	  <script type="text/javascript" src="http://maps.stamen.com/js/tile.stamen.js?v1.2.4"></script>
 

  <script>
	//set up some variables to match data source	
	var theSelected = 'ALL';
	var score2013 = theSelected + "_API13";
	var	score2012 = theSelected + "_API12";
	var num2013 = theSelected + "_NUM";
	var selectedLabel = labels[theSelected];
	var geojson;

$("#menu li a").click(function(){
	$("#dropMenu").collapse('hide');
});
	
$('#nav').affix({
      offset: {
        top: $('header').height()
      }
	});	
$('#menu li').click(function(){
	$('#menu li').removeClass('active');
	
	$(this).addClass('active');

});	
$('#sidebar').affix({
      offset: {
        top: 200
      }
});	
	
	//ESTABLISH DATA BUCKETS AND COLORS
	function getColor(d) {
    return d > 900 ? '#2c7bb6' :
           d > 800  ? '#abd9e9' :
           d > 700  ? '#fed98e' :
           d > 600  ? '#fdae61' :
           d > 500  ? '#d7191c' :
                       '#cdc9c9';
	}
	
	
	//CREATE A BASIC MAP
	//var map = L.map('map').setView([37.7919584,-122.2287941,13], 12);
	
	var layer = new L.StamenTileLayer("toner");
	var map = new L.Map("map", {
    center: new L.LatLng(37.7919584,-122.2287941),
    zoom: 12
});

	map.addLayer(layer);
	
	
	//DYNAMICALLY ASSIGN A STYLE TO LAYER
	function style(feature) {
    //console.log(theSelected);
	return {
        fillColor: getColor(feature.properties[score2013]),
        weight: 2,
        opacity: 1,
        color: getColor(feature.properties[score2013]),
        fillOpacity: 0.9
    };
}

var geojsonMarkerOptions = {
    radius: 8,
    fillColor: "#ff7800",
    color: "#000",
    weight: 1,
    opacity: 1,
    fillOpacity: 0.8
};

function highlightFeature(e) {
			var layer = e.target;
			//console.log(layer)
			layer.setStyle({
				fillColor: getColor(layer.feature.properties[score2013]),
        		weight: 4,
        		opacity: 1,
        		color: '#333333',
        		fillOpacity: 0.9
			});

			if (!L.Browser.ie && !L.Browser.opera) {
				layer.bringToFront();
			}
		}

function resetHighlight(e){
	theSchoolLayer.resetStyle(e.target)
}

		
function theFilter(feature,layer){
	//console.log("yeah : " + theSelected);
	return feature.properties[score2013] > 0;
}
//GOOGLE CHART
function drawChart(feature){
	$("#summaryBox").show();
	$('#schoolTitle').html(feature.properties.School)
	
	console.log(feature.properties);

	$('#chartArea').highcharts({
        chart: {
            type: 'bar'
        },
        title: {
            text: ""
        },
        xAxis: {
            categories: ["All Students","Asian","Black/African American","Latino","White","English Learners","Socioeconomically Disadvantaged","Disability"]
        },
        yAxis: {
            title: {
                text: 'API Score'
            },
            ceiling: 1000

        },
        series: [{
            name: feature.properties.School,
            data: [feature.properties.ALL_API13,feature.properties.AS_API13,feature.properties.AA_API13,feature.properties.HI_API13,feature.properties.WH_API13,feature.properties.EL_API13,feature.properties.SD_API13,feature.properties.DI_API13]
        }, {
            name: 'District',
            data: [721,824,644,687,896,686,687,552]
        }]
    });
	

}



function onEachFeature(feature, layer) {
		// draw the chart on layer click
		score2013 = theSelected + "_API13";
		score2012 = theSelected + "_API12";
		num2013 = theSelected + "_NUM";
		selectedLabel = labels[theSelected];
		
		
		layer.on({
        mouseover: highlightFeature,
        mouseout: resetHighlight
        });
		//add functions to map click like chart draw and table highlight
		layer.on('click',function(){
			drawChart(feature);
			//SCROLL TO ROW IN TABLE
			//var w = $('#theScores');	
			$('#theScores tr').removeClass('activeRow')
			var row = $('#r' + feature.properties.NCESSchool).addClass('activeRow');
			var rowpos = $('#r' + feature.properties.NCESSchool).position();

			$('#theScores').scrollTop(rowpos.top);
			//if(row.length){
			//	w.scrollTop(row.offset().top - (w.height()/2));
			//}

			//$("#r" + feature.properties.NCESSchool).get(0).scrollIntoView();
			//$("#r" + feature.properties.NCESSchool).css("border:solid thick green");

		});
		
		//CREATE  VALUES FOR GROUP

			var theDiffClass = "same";
			//console.log(score2013);
			var theDiff = feature.properties[score2013] - feature.properties.ALL_API13;
			//console.log (theDiff);
		
		switch (true){
			case theDiff > 0:
				theDiffClass = "glyphicon glyphicon-arrow-up over";
				break;
			
			case theDiff < 0:
				theDiffClass = "glyphicon glyphicon-arrow-down under";
				break;
			
		}
		
		
		$("#selScore").html(labels[theSelected] + "<br/> API Score" )
		
		if(theSelected == 'ALL'){
			layer.bindPopup("<div id='thePopup'><strong>" + feature.properties.School + "</strong><BR/>" + feature.properties.MailStreet + "<br>Oakland,CA " + feature.properties.Zip + "<h2 style='margin-bottom:1px'>" + feature.properties[score2013] + "<span style='color:#333333;font-size:12px;font-weight:bold'>:  SCHOOL API</span></h2><span style='width:100%;text-align:center;font-size:12px'> (" + feature.properties[num2013] + " Students Tested)</span></div>" 
				);
			$('.thirdColumn').hide();
		}
		else {
			//POPUP FOR SUBGROUP
			layer.bindPopup("<div id='thePopup'><strong>" + feature.properties.School + "</strong><BR/>" + feature.properties.MailStreet + "<br>Oakland,CA " + feature.properties.Zip + "<h2 style='margin-bottom:1px;color:#808080'>" + feature.properties.ALL_API13 + "<span style='color:#333333;font-size:12px;font-weight:bold'>:  SCHOOL API</span></h2><span style='width:100%;text-align:center;font-size:12px'> (" + feature.properties.ALL_NUM + " Students Tested)</span><h2 style='margin-bottom:1px'>" + feature.properties[score2013] + "<span style='color:#333333;font-size:12px;font-weight:bold'>:  " + selectedLabel + " API</span></h2><span style='width:100%;text-align:center;font-size:12px'> (" + feature.properties[num2013] + " Students Tested)</span><h3 class='text-center thirdColumn'><span class='text-center "+ theDiffClass +"  thirdColumn'>" + theDiff + "</span></h3></div>"  
				);	
			$('.thirdColumn').show();
			}
		//create row in table	
		$('#theSchools').append("<tr id='r" + feature.properties.NCESSchool + "'><td id='firstRow'><a href='#' id='s" + feature.properties.NCESSchool + "'>" + feature.properties.School + "</a></td><td>" + feature.properties[score2013] + 
			"</td><td class='thirdColumn' style='padding-left:10px'><span class='" + theDiffClass + "'></span>  " +
			theDiff +"</td></tr>");

		
		//bind to map popup
		$("#s" + feature.properties.NCESSchool).click(function(){
			console.log(feature.properties.NCESSchool);
			drawChart(feature);
			layer.openPopup();
			});
		

		
		

		
		
		
		
			
	
		
	}

//MAKE A MAP!
function resetMap(){
	try {
		
		map.removeLayer(theSchoolLayer);
		//console.log('remove');
	}catch(e){
	//console.log('nothin');
	}
	
	$("#theSchools tr").remove();
	theSchoolLayer = L.geoJson(schools,{
		style:style,
		pointToLayer:function(feature,latlng){
			return L.circleMarker(latlng,geojsonMarkerOptions);
		},
		filter:theFilter,
		onEachFeature:onEachFeature
		}).addTo(map);
	$("#theScores").tablesorter();
}

//ACTION STEP
resetMap();
	//random button click stuff


//CREATE A LEGEND!!!
	$(document).ready(function(){
			var grades = [500,600,700,800,900],
			labels = [],
			from,to;
			
			labels.push('<li style="color:#333333">API LEGEND</li>');
			for (var i = 0; i < grades.length; i++) {
			from = grades[i];
			to = grades[i + 1];
			//console.log(getColor(from + 1));
			labels.push(
			'<li style="background:' + getColor(from + 1) + '">' +
			from + (to ? '&ndash;' + to : '+') + '</li>');
			$('#legendList').html(labels.join(''));
			};
		
	
	//$('#summaryBox').html("District-wide Average :<h4> All Students</h4><span id='theTotal'>" + allScores.All + '</span>');
	 $("#theScores").tablesorter({sortList:[[1,1]]}); 
	});
	
//CONTROLS FOR MENU GO HERE!!

$('.nav a').click(function(a){
	$('#theSchools tr').empty();
	theSelected = $(this).attr('data-match');
	//$('#summaryBox').html("District-wide Average : " + $(this).text() + ' : ' + allScores[theSelected] + '<br/>');
	score2013 = theSelected + "_API13";
	score2012 = theSelected + "_API12";
	num2013 = theSelected + "_NUM";
	selectedLabel = labels[theSelected];
	resetMap();
});



  </script>

<script>
// Include the UserVoice JavaScript SDK (only needed once on a page)
UserVoice=window.UserVoice||[];(function(){var uv=document.createElement('script');uv.type='text/javascript';uv.async=true;uv.src='//widget.uservoice.com/XXDvpOzOrqSL0CTyecDOXQ.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(uv,s)})();

//
// UserVoice Javascript SDK developer documentation:
// https://www.uservoice.com/o/javascript-sdk
//

// Set colors
UserVoice.push(['set', {
  accent_color: '#448dd6',
  trigger_color: 'white',
  trigger_background_color: '#6aba2e'
}]);

// Identify the user and pass traits
// To enable, replace sample data with actual user traits and uncomment the line
UserVoice.push(['identify', {
  //email:      'john.doe@example.com', // User’s email address
  //name:       'John Doe', // User’s real name
  //created_at: 1364406966, // Unix timestamp for the date the user signed up
  //id:         123, // Optional: Unique id of the user (if set, this should not change)
  //type:       'Owner', // Optional: segment your users by type
  //account: {
  //  id:           123, // Optional: associate multiple users with a single account
  //  name:         'Acme, Co.', // Account name
  //  created_at:   1364406966, // Unix timestamp for the date the account was created
  //  monthly_rate: 9.99, // Decimal; monthly rate of the account
  //  ltv:          1495.00, // Decimal; lifetime value of the account
  //  plan:         'Enhanced' // Plan name for the account
  //}
}]);

// Add default trigger to the bottom-right corner of the window:
UserVoice.push(['addTrigger', { mode: 'contact', trigger_position: 'bottom-right' }]);

// Or, use your own custom trigger:
//UserVoice.push(['addTrigger', '#id', { mode: 'contact' }]);

// Autoprompt for Satisfaction and SmartVote (only displayed under certain conditions)
UserVoice.push(['autoprompt', {}]);
</script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-697750-16', 'urbanstrategies.github.io');
      ga('send', 'pageview');
    </script>

 
  </body>
</html>
