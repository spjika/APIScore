<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Scores</title>
  <meta name="description" content="OUSD API Scores Web Map">
  <meta name="author" content="InfoAlameda">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">

<!-- Optional theme -->
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="styles.css">
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
<!--Actual Mark-up-->
<header class="title" style="margin-bottom:20px">
  <div class="container-fluid">
	<div class="row-fluid vcenter">
		<div class='col-md-3'>
			<a href="https://www.gopublicschools.org/"><img src="https://www.gopublicschools.org/images/go_c4_logo.gif" alt="Go Public Schools Logo"></a>
		</div>
		<div class="col-md-7 vcenter">
			<h1>Oakland Public Schools API Scores</h1>
		</div>
		<div class="col-md-2 vcenter">
			<button type="button" class="btn btn-default"><a class="abot" href="#abt"><span id="btnAbout" class="glyphicon glyphicon-info-sign"></span></a></button>
		</div>
	</div>
	  <div class="row-fluid">
		<div class="col-md-6">
		  <div class="pull-right hidden-sm">    
			<!--<h1><a href="#glyphicon"><i class="glyphicon glyphicon-user"></i> <i class="glyphicon glyphicon-chevron-down"></i></a></h1>-->
		  </div>
		</div>
	  </div>
  </div>
</header>
<div class="col-md-12">	
	<nav class="navbar navbar-default" role="navigation">
		<div class="container-fluid">
			<div class="navbar-header navbar-inner col-md-12">
			  <button type="button" class="navbar-toggle" id="dropDownMenu" data-toggle="collapse" data-target=".navbar-collapse">
				<span class="sr-only">Select a subgroup</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			  </button>
			 
			 <div class="collapse navbar-collapse" id="dropMenu">
				<ul id="menu" class="nav navbar-nav navbar-inner">
				  <li class="active"><a data-match= 'Schoolwide' href="#contact">ALL STUDENTS</a></li>
				  <li><a data-match= 'Asian' href="#contact">ASIAN</a></li>
				  <li><a data-match= 'Black' href="#contact">AFRICAN AMERICAN/BLACK</a></li>
				  <li><a data-match= 'Hispanic' href="#contact">HISPANIC</a></li>
				  <li><a data-match= 'White' href="#contact">WHITE</a></li>
				  <li><a data-match= 'EngLearner' href="#contact">ENGLISH LEARNER</a></li>
				  <li><a data-match= 'LowIncome' href="#contact">LOW INCOME</a></li>
				  <li><a data-match= 'Disability' href="#contact">DISABILITY</a></li>

				</ul>
			</div>
		</div> 
	</nav>
</div>
	<div class="container-fluid" style="margin-top:20px">
		
		<div class="row-fluid">
			<div class="col-md-8">
				<div class="row">
					<div id="map" class="shadow">
					</div>
				</div>
				<div class="row">
					<ul class="nav" id="legendList">
							<li>Above 900</li>
							<li>800 to 899</li>
							<li>700 to 799</li>
							<li>600 to 699</li>
							<li>500 to 599</li>
							<li>Below 5000</li>
					
					 </ul>
				</div>
			</div>
		
			<div class="col-md-4" id="infoArea">
				
				
				<div class="row">
					<div class="col-md-10">
					<!--<h4 id='theDistrict'></h4>-->
						<div id="selectedSchool">
							
						<table id="theScores" class="tablesorter">
							<thead>
							<tr>
								<th>School<span  class="glyphicon glyphicon-eject" style="color:#66CD00;float:right" ></span></th>
								<th id="selScore"><span  style="color:#66CD00" class="glyphicon glyphicon-eject" ></span> API Score</th>
								<th>Difference from All Students<span  class="glyphicon glyphicon-eject" style="color:#66CD00;float:right" ></span></span></th>
							</tr>
							</thead>
							<tbody id="theSchools">
							
							</tbody>
						</table>
						</div>
					</div>
				</div>
			
				<div class="row">
					<div class="col-md-10">
						<div id="summaryBox" style="display:none">
						
							<div id="chartArea"></div>
						</div>
					</div>
				</div>
			</div>
		<div class="row-fluid">
			<div class="col-md-8" id="aboutsection">
			<!--<a name="about"></a>-->
				<h2><a name="abt"></a>Oakland Public School API Scores<p class="lead">For School Year 2012 to 2013 </p></h2>
				<p>The API measures the academic performance and improvement of schools based on results from the Standardized Reporting and Testing (STAR) and the California High School Exit Examination (CAHSEE). The State set 800 out of possible 1,000 as the API target for all schools to meet.</p>
			</div>
		</div>
    
  <!--script stuff-->
	  <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
	  <script src="jquery.tablesorter.min.js"></script>
	  <link rel="stylesheet" href="style.css" />
	  <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
	  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
	  <script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>
	  <script src="OUSD_API_0610.geojson"></script>
	  <script src="Data.js"></script>
	  <script type="text/javascript" src="highcharts.js"></script>
	  <script type="text/javascript" src="http://maps.stamen.com/js/tile.stamen.js?v1.2.4"></script>
 

  <script>

$("#menu li a").click(function(){
	$("#dropMenu").collapse('hide');
});
	
$('#nav').affix({
      offset: {
        top: $('header').height()
      }
	});	
$('#menu li').click(function(){
	$('#menu li').removeClass('active');
	
	$(this).addClass('active');

});	
$('#sidebar').affix({
      offset: {
        top: 200
      }
});	
	var theSelected = 'Schoolwide';
	//ESTABLISH DATA BUCKETS AND COLORS
	function getColor(d) {
    return d > 900 ? '#2c7bb6' :
           d > 800  ? '#abd9e9' :
           d > 700  ? '#fed98e' :
           d > 600  ? '#fdae61' :
           d > 500  ? '#d7191c' :
                       '#cdc9c9';
	}
	
	
	//CREATE A BASIC MAP
	//var map = L.map('map').setView([37.7919584,-122.2287941,13], 12);
	
	var layer = new L.StamenTileLayer("toner");
var map = new L.Map("map", {
    center: new L.LatLng(37.7919584,-122.2287941),
    zoom: 12
});

	map.addLayer(layer);
	
	
	//DYNAMICALLY ASSIGN A STYLE TO LAYER
	function style(feature) {
    console.log(theSelected);
	return {
        fillColor: getColor(feature.properties[theSelected]),
        weight: 2,
        opacity: 1,
        color: getColor(feature.properties[theSelected]),
        fillOpacity: 0.9
    };
}

var geojsonMarkerOptions = {
    radius: 8,
    fillColor: "#ff7800",
    color: "#000",
    weight: 1,
    opacity: 1,
    fillOpacity: 0.8
};
function highlightFeature(e) {
			var layer = e.target;

			layer.setStyle({
				weight: 2,
				color: '#fff',
				dashArray: '',
				fillOpacity: 0.7
			});

			if (!L.Browser.ie && !L.Browser.opera) {
				layer.bringToFront();
			}

			info.update(layer.feature.properties);
		}

function resetHighlight(e) {
			geojson.resetStyle(e.target);
			info.update();
		}
		
function theFilter(feature,layer){
	//console.log("yeah : " + theSelected);
	return feature.properties[theSelected] >0;
}
//GOOGLE CHART
function drawChart(feature){
	$("#summaryBox").show();
	$('#schoolTitle').html(feature.properties.School)
	
	
	$('#chartArea').highcharts({
        chart: {
            type: 'bar'
        },
        title: {
            text: feature.properties.School
        },
        xAxis: {
            categories: ["All Students","Asian","Black or African American","Hispanic or Latino","White"]
        },
        yAxis: {
            title: {
                text: 'API Score'
            },
            ceiling: 1000

        },
        series: [{
            name: feature.properties.School,
            data: [feature.properties.Schoolwide,feature.properties.Asian,feature.properties.Black,feature.properties.Hispanic,feature.properties.White]
        }, {
            name: 'District',
            data: [721,824,644,687,896]
        }]
    });
	

}

function onEachFeature(feature, layer) {
		// make the popup
		layer.on('click',function(){
			drawChart(feature);
		});
		
		
		
		var theDiffClass = "same";
		var theDiff = feature.properties[theSelected] - feature.properties.Schoolwide;
		console.log (theDiff);
		switch (true){
			case theDiff > 0:
				theDiffClass = "glyphicon glyphicon-arrow-up over";
				break;
			
			case theDiff < 0:
				theDiffClass = "glyphicon glyphicon-arrow-down under";
				break;
			
		}
		
		$("#selScore").html(theSelected + "<br/> Api Score" )
		//create row in table
		$('#theSchools').append("<tr><td><a href='#'id='s" + feature.properties.NCESSchool + "'>" + feature.properties.School + "</a></td><td>" + feature.properties[theSelected] + 
		"</td><td style='padding-left:10px'><span class='" + theDiffClass + "'></span>  " +
		theDiff +"</td></tr>");
		//bind to map popup
		$("#s" + feature.properties.NCESSchool).click(function(){
			drawChart(feature);
			layer.openPopup();
			});
	layer.bindPopup("<div id='thePopup'><strong>" + feature.properties.School + "</strong><BR/>" + feature.properties.MailStreet + "<br>Oakland,CA " + feature.properties.Zip
		+ "<br/> Difference from schoolwide:<br/><span style='font-size:20px' class='" + theDiffClass + "'>  " +
		theSelected + " : " + theDiff + "</span></div>"
		);	
	}

//MAKE A MAP!
function resetMap(){
	try {
		
		map.removeLayer(theSchoolLayer);
		console.log('remove');
	}catch(e){
	console.log('nothin');
	}
	
	$("#theSchools tr").remove();
	theSchoolLayer = L.geoJson(schools,{
		style:style,
		pointToLayer:function(feature,latlng){
			return L.circleMarker(latlng,geojsonMarkerOptions);
		},
		filter:theFilter,
		onEachFeature:onEachFeature
		}).addTo(map)
	$("#theScores").tablesorter();
}

//ACTION STEP
resetMap();
	//random button click stuff


//CREATE A LEGEND!!!
	$(document).ready(function(){
			var grades = [500,600,700,800,900],
			labels = [],
			from,to;
			
			labels.push('<li style="color:#333333">API LEGEND</li>');
			for (var i = 0; i < grades.length; i++) {
			from = grades[i];
			to = grades[i + 1];
			console.log(getColor(from + 1));
			labels.push(
			'<li style="background:' + getColor(from + 1) + '">' +
			from + (to ? '&ndash;' + to : '+') + '</li>');
			$('#legendList').html(labels.join(''));
			};
		
	
	//$('#summaryBox').html("District-wide Average :<h4> All Students</h4><span id='theTotal'>" + allScores.All + '</span>');
	 $("#theScores").tablesorter({sortList:[[1,1]]}); 
	});
	
//CONTROLS FOR MENU GO HERE!!

$('.nav a').click(function(a){
	$('#theSchools tr').empty();
	theSelected = $(this).attr('data-match');
	//$('#summaryBox').html("District-wide Average : " + $(this).text() + ' : ' + allScores[theSelected] + '<br/>');
	resetMap();
});

  </script>
 
  </body>
</html>
